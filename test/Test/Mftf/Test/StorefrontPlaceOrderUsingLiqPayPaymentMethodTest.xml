<?xml version="1.0" encoding="UTF-8"?>
<!--
/**
 * Copyright Â© Pronko Consulting (https://www.pronkoconsulting.com)
 * See LICENSE for the license details.
 */
-->
<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="StorefrontPlaceOrderUsingLiqPayPaymentMethodTest">
        <annotations>
            <stories value="Placing an order using LiqPay payment method"/>
            <title value="Place order using LiqPay payment method"/>
            <description value="Customer should be able to place order using LiqPay payment method"/>
            <severity value="MAJOR"/>
            <group value="checkout"/>
            <group value="liqpay"/>
        </annotations>

        <before>
            <!--Create category-->
            <createData entity="_defaultCategory" stepKey="createCategory"/>
            <!--Create product-->
            <createData entity="_defaultProduct" stepKey="createProduct">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <!--Create customer-->
            <createData entity="UA_Customer" stepKey="createCustomer"/>
            <!--Set LiqPay Sandbox Credentials-->
            <createData entity="LiqPaySandboxConfig" stepKey="setLiqPaySandboxConfig"/>
            <!--Login to Admin page -->
            <actionGroup ref="LoginAsAdmin" stepKey="loginToAdminPage"/>
        </before>

        <after>
            <!--Delete category-->
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
            <!--Delete product-->
            <deleteData createDataKey="createProduct" stepKey="deleteProduct"/>
            <!--Delete customer-->
            <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
            <!--Set LiqPay Settings to default values-->
            <createData entity="DefaultLiqPayConfig" stepKey="setDefaultLiqPayConfig"/>
            <!--Clear orders grid filters-->
            <actionGroup ref="AdminOrdersGridClearFiltersActionGroup" stepKey="clearOrdersGridFilters"/>
            <!--Logout from Customer account-->
            <actionGroup ref="StorefrontCustomerLogoutActionGroup" stepKey="logoutCustomer"/>
            <!--Logout from Admin page-->
            <actionGroup ref="logout" stepKey="logoutFromAdminPage"/>
        </after>

        <!--Login as Customer-->
        <actionGroup ref="LoginToStorefrontActionGroup" stepKey="customerLogin">
            <argument name="Customer" value="$$createCustomer$$" />
        </actionGroup>

        <!--Add Product to shopping cart-->
        <actionGroup ref="AddSimpleProductToCart" stepKey="addProductToCart">
            <argument name="product" value="$$createProduct$$"/>
        </actionGroup>

        <!--Go to Checkout page-->
        <actionGroup ref="GoToCheckoutFromMinicartActionGroup" stepKey="goToCheckoutPage" />

        <!--Select "Flat Rate" shipping method and click "Next"-->
        <click selector="{{CheckoutShippingMethodsSection.shippingMethodFlatRate}}" stepKey="selectFlatRateShippingMethod"/>
        <click selector="{{CheckoutShippingSection.next}}" stepKey="clickNextButton"/>
    </test>
</tests>
